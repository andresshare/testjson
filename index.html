<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <title>JSON</title>
</head>

<body>

<div id="output">
    <ul id="taskList"></ul>
</div>
<form id="myForm"> Task :
    <input type="text" name="task" placeholder="add task">
    <input type="submit" value="Add new Task"> </form>
<script type="text/javascript">
    let dataJSON = '';
    let output = document.getElementById('output');
    let taskList = document.querySelector('#taskList');
    document.getElementById('myForm').addEventListener('submit', function (e) {
        e.preventDefault();
        let tempValue = document.querySelector('input[name="task"]').value;
        addNewItem({
            "info": tempValue
            , "status": false
        })
    })
    window.onload = function () {
        if (sessionStorage['tasklist'] != null) {
            dataJSON = JSON.parse(sessionStorage['tasklist']);
            buildCheckboxes(dataJSON)
        }
        else {
            let data = '[{"info":"Cut the Grass","status":false},{"info":"Clean Room","status":true},{"info":"Go to Gym","status":false},{"info":"Make Dinner","status":false}]';
            dataJSON = JSON.parse(data);
            buildCheckboxes(dataJSON)
        }
    }

    function addNewItem(data) {
        addCheckbox(data, dataJSON.length);
        dataJSON.push(data);
        sessionStorage['tasklist'] = JSON.stringify(dataJSON);
    }

    function addCheckbox(data, key) {
        let li = document.createElement('li');
        let checkbox = document.createElement('input')
        let textInside = document.createTextNode(data.info);
        let span = document.createElement('span');
        span.innerHTML = 'x';
        span.onclick = remove;
        checkbox.type = 'checkbox';
        checkbox.value = key;
        checkbox.checked = data.status;
        checkbox.setAttribute('onchange', 'updateJSON()');
        li.appendChild(textInside);
        li.appendChild(checkbox);
        li.appendChild(span);
        document.querySelector('#taskList').appendChild(li);
    }

    function remove(event) {
        let index = this.previousElementSibling.value;
        taskList.innerHTML = '';
        dataJSON.splice(index, 1)
        buildCheckboxes(dataJSON)
    }

    function buildCheckboxes(data) {
        for (let key in data) {
            addCheckbox(data[key], key)
        }
    }

    function updateJSON() {
        let key = event.target.value;
        dataJSON[key].status = event.target.checked;
        sessionStorage['tasklist'] = JSON.stringify(dataJSON);
    }
</script>
</body>

</html>